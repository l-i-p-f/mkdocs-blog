# 图数据库比较

本文主要涉及

1. Jena TDB使用过程中存在的问题总结（个人使用不顺手的地方）
2. 对主流图数据库进行简单调研


## TDB的不足

在上一个业务过程中使用了TDB作图模型的存储介质，但发现一些问题。

**TDB的缺陷**

1. TDB是**基于内存**的数据库，当数据规模上来后，可能面临内存性能不足问题

2. TDB仅支持单机存储，**不支持分布式**！导致无法大规模商用 

	- 解决方案：Jena SDB，是一种基于关系数据库存储SPO索引的技术，支持SparQL。但SDB性能比TDB低很多，测试了三个场景的查询，TDB平均在10ms的查询，SDB需要700-1000ms

3. TDB**不支持多线程访问**，数据库端口每次会被一个线程锁住，其他线程无法访问

	- 解决方案：多线程访问TDB的上层服务，如Fuseki

4. 存在**数据同步问题**，RDF通常是中间数据而不是原始数据，因此需要额外的操作来保证数据的更新，会导致实时性要求得不到保障，随着数据规模增大同时也会增加更新成本

	- 解决方案：虚拟知识图谱

5. TDB支持的图查询语言**SparQL不支持未知数量节点的查询**

	- 如SparQL不支持路径搜索，即给定图上两个节点，SparQL不能自动找出两节点间的所有路径或最短/长路径，仅能做到判断两节点是否相连，但dfs/bfs是图计算中十分常用的需求



**结论**

- Jena框架的应用简单，图存储，更新，查询效率也挺高，RDF迁移性也较好，但只适合单机探索使用。
- 数据规模提升，或有分布式需求等，则还是选择图数据库较好。

<br>

## 图数据库

知识图谱数据存储的方式一般可分为：

- 基于关系数据模型
  - 关系数据库：MySQL …
- 基于图数据模型
  - RDF存储：Jena TDB …
  - 图数据库：Neo4J、ArangoDB …

### 与关系数据库比，图数据库的优势
>1. 使用图的方式，可以很自然地表达现实世界中的实体及其关联关系
>2. 灵活的数据模型可以适应不断变化的业务需求
>3. 灵活的图查询语言，轻松实现复杂关系网络的分析
>4. 关系型数据库在遍历关系网络并抽取信息的能力非常弱，图数据库则为此而生
>5. 关系型数据库在数据规模庞大时很难做多层关联关系分析（Join操作往往消耗过长时间而失败），图数据库则天然把关联数据连接在一起，无需耗时耗内存的Join操作，可以保持常数级时间复杂度

<br>

关系数据库在图遍历上效率远低于图数据库，而RDF存储可参考上面，因此图数据库应是最佳的选择。

### 图数据库比较

注：社区活跃度/成熟度主要参考DB ranking和Github Star（截止2021/2/24）

|              | **名称**    | **初次release** | **开源协议**  | **是否可商用** | **规格**                      | **社区活跃度**/**成熟度** | **查询语言**       | **分布式** | **备注**                                                     |
| ------------ | ----------- | --------------- | ------------- | -------------- | ----------------------------- | ------------------------- | ------------------ | ---------- | ------------------------------------------------------------ |
| 图数据库     | Neo4j社区版 | 2007            | GPLv3、AGPLv3 | 否             | 34.4亿节点344亿关系6870亿属性 | ☆☆☆                       | Cypher             | 不支持     | 不开源，不支持分布式                                         |
|              | Neo4j商用版 |                 | -             | 是、涉A        |                               |                           |                    | 支持       | 涉A                                                          |
|              | OrientDB    | 2010            | Apache V2     | 是             |                               | ☆☆                        | Gremlin，扩展的SQL | 后期支持   | 最初是单机数据库，后期才支持分布式<br>  性能和可扩展性似乎不好 |
|              | ArangoDB    | 2012            | Apache V2     | 是             | 十亿边                        | ☆☆☆                       | AQL                | 后期支持   | 企业版收费<br>  插入性能低                                 |
|              | DGraph      | 2016            | Apache V2     | 是             |                               | ☆☆                        | GraphQL            | 原生支持   |                                                              |
|              | JanusGraph  | 2017            | Apache V2     | 是             | 取决于选用的底层存储系统      | ☆☆                        | Gremlin            | 原生支持   | 存储系统可使用HBASE，索引系统可使用ES；<br>大数据生态兼容性好；<br> 但需要同时维护几套系统，复杂度高，增加运维成本和系统风险 |
|              | GES图引擎   |                 | -             | 是   | 分布式，最高可支持千亿边      | ☆                         | Gremlin            | 支持       | 仅支持运行在华为云上<br>                                         |
| 三元组数据库 | Jena TDB    | 2000            | Apache V2     | 是             |                               | ☆☆                        | SparQL             | 不支持     |                                                              |
| 关系型数据库 | GaussDB     |                 | -             | 是   |                               | ☆☆                        | SQL                | 支持       | 关系型数据库及NoSQL数据库<br>对图计算支持非常差，需要自己实现，且性能较差 |

<br>

**总结：图数据库选择可优先考虑ArangoDB或JanusGraph，次优先级考虑DGraph。**

<br>

## 参考

1. 知识图谱调研
2. 分布式图数据库在贝壳的应用实践Dgraph VS JanusGraph
3. 知识图谱简介与JanusGraph调研
